<!DOCTYPE html>
<html>
<head>
	<title>MEDICULLY</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>
	<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
	<style type="text/css">
		.marg{
			margin-left: 5px;
			margin-right: 5px;
		}
		.hov:hover{
			color: white;
			text-shadow: 0.5px 0.5px 0.5px #000;
			text-decoration: none;
		}
    .hov2:hover{
      color: green;
      text-decoration: none;
    }
		body{
			font-family: lato !important;
		}
		.modal {
		    overflow-y: auto;
		}
    .fontinc{
      font-size: 19px;
    }
    .verticalLine {
      border-right: 1px solid hsl(0, 0%, 78%);
    }
    .verticalLine2 {
      border-left: 1px solid hsl(0, 0%, 78%);
    }
	</style>
</head>
<body>
  <div id="menu" >
  	<nav class="navbar navbar-expand-md" style="background: hsl(0, 0%, 78%);width: 100%">
  	  <div class="container-fluid">
  	    <div class="navbar-header">
  	      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#myNavbar">
  	        <span class="navbar-toggler-icon"></span>
  	      </button>
  	    </div>
  	    <div class="collapse navbar-collapse" id="myNavbarleft">
  	      <a href="/home"><img class="navbar-brand" src="/public/logo.PNG" alt="logo"></a>
  	      <ul class="navbar-nav mr-auto text-center">
  	        <li class="nav-item marg"><a class="nav-link hov" href="/blood_donors">BLOOD DONORS</a></li>
  	        <li class="w3-dropdown-hover nav-item marg">
  	        	<a class="nav-link hov" href="/about">ABOUT</a>
  	        	<ul id="Demo" class="w3-dropdown-content w3-bar-block w3-card-4 w3-animate-zoom dropdown-menu">
  	              <li><a class="dropdown-item w3-button" href="#">About Us</a></li>
  	              <li><a class="dropdown-item w3-button" href="#">Contact Us</a></li>
  	            </ul>
  	        </li>
  	      </ul>
  	    </div>
  	  <div class="collapse navbar-collapse" id="myNavbarright">
  	      <ul class="navbar-nav ml-auto text-center">
            <li class="nav-item marg nav-link" style="color:green;font-size:16px;">
              Hello&nbsp;&nbsp;<% if(role == 'doctor'){ %><i>DR.<%= name.toUpperCase() %></i>
                    <% }else {%><i><%= name.toUpperCase() %></i></li>
                    <% } %>
  	        <li class="nav-item marg"><a class="nav-link hov" href="/my_profile">PROFILE</a></li>
            <li class="nav-item marg"><a class="nav-link hov" href="/my_request">REQUESTS</a></li>
  	        <li class="nav-item marg"><a class="nav-link hov" href="/logout">LOGOUT</a></li>
  	      </ul>
  	    </div>
  			</div>
  	</nav>
  </div>
<div class="row" style="margin-top:20px">
  <div class="col-sm-1"></div>
  <div class="col-sm-10 container-fluid" id="pro_body">
    <p style="text-align: center;">
        <img src="/public/loader.gif" alt="loading" class="mx-auto" style="width:55px;margin-top: 200px;margin-bottom: 200px;">
      </p>
  </div>
  <div class="col-sm-1"></div>
</div>
<div class="modal fade" id="reqfailModal">
   <div class="modal-dialog modal-dialog-centered">
     <div class="modal-content">
       <div class="modal-body">
       <p style="text-align:center;">PLEASE LOGIN TO REQUEST..IF ALREADY LOGGED IN, YOU MIGHT HAVE REQUESTED YOURSELVES. PLEASE TRY REQUESTING SOMEONE ELSE..</p>
       </div>
     </div>
   </div>
</div>
<div class="modal fade" id="reqsuccModal">
   <div class="modal-dialog modal-dialog-centered">
     <div class="modal-content">
       <div class="modal-body">
       <p style="text-align:center;color:green;">REQUESTED SUCCESSFULLY</p>
       </div>
     </div>
   </div>
</div>
<div class="row container-fluid" style="padding: 10px;background: hsl(0, 0%, 78%);margin-top: 20px;">
  <div class="col-sm-2"></div>
  <div class="col-sm-8">
    <div class="row container-fluid" style="text-align: center;">
      <div class="col-sm-4">
        <h4 style="color: green;">MEDICULLY</h4><br/>
        <p><a href="/home" class="hov">Home</a></p>
        <p><a href="/my_profile" class="hov">Profile</a></p>
        <p><a href="/my_request" class="hov">Requests</a></p>
        <p><a href="/blood_donors" class="hov">Blood Donors</a></p>
      </div>
      <div class="col-sm-4">
        <h4 style="color: green;">ABOUT</h4><br/>
        <p><a href="/about" class="hov">About Us</a></p>
        <p><a href="#" class="hov">Privacy Policy</a></p>
        <p><a href="#" class="hov">Terms Of Service</a></p>
        <p><a href="/about" class="hov">Contact Us</a></p>
      </div>
      <div class="col-sm-4">
         <h4 style="color: green;">CONNECT</h4><br/>
        <p><a href="#" class="hov"><i class="fa fa-facebook-official" style="font-size:25px;cursor:pointer" title="Facebook"></i>&nbsp;&nbsp;Facebook</a></p>
        <p><a href="#" class="hov"><i class="fa fa-instagram" style="font-size:25px;cursor:pointer" title="Instagram"></i>&nbsp;&nbsp;Instagram</a></p>
        <p><a href="#" class="hov"><i class="fa fa-twitter-square" style="font-size:25px;cursor:pointer" title="Twitter"></i>&nbsp;&nbsp;Twitter</a></p>
        <p><a href="#" class="hov"><i class="fa fa-youtube" style="font-size:25px;cursor:pointer;" title="Youtube"></i>&nbsp;&nbsp;Youtube</a></p>
      </div>
    </div>
  </div>
  <div class="col-sm-2"></div>
  <div class="container-fluid">
    <p style="text-align: center;font-size: 17px;"><em>All CopyRights Reserved.<b> Medicully Â©2018</b></em></p>
  </div>
</div>
<script type="text/javascript">
  var x = '';
  $(document).ready(function(){
    var xhttp= new XMLHttpRequest();
    xhttp.open('GET', '/get_type/<%= un %>', true);
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send();
    xhttp.onreadystatechange = function(){
      if (xhttp.readyState == 4 && xhttp.status == 200) {
        data2 = JSON.parse(xhttp.responseText);
        var xhttp2= new XMLHttpRequest();
        xhttp2.open('GET', '/profile/<%= un %>', true);
        xhttp2.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhttp2.send();
        xhttp2.onreadystatechange = function(){
          if (xhttp2.readyState == 4 && xhttp2.status == 200) {
            data =JSON.parse(xhttp2.responseText);
            if(data == null)
            {
              window.location.assign('/home');
            }
            x += '<div class="row">\
                 <div class="col-sm-3 text-center" style="padding: 25px;">\
                 <h3 style="text-align: center;color: green;" id="name_heading">'+ data.name.toUpperCase() +'</h3><br/>\
                 <img class="mx-auto" src="'+ data.pic_path +'" alt="'+ data.name +'" style="width:17vw;height: 17vw;display: block; border-radius: 3px;">\
                 </div>\
                 <div class="col-sm-9 verticalLine2" id="profile_body">\
                 <h3 style="text-align: center;color: green;">USER PROFILE</h3></br>\
                     <div class="row">\
                      <div class="col-sm-5" style="text-align: right;">\
                        <p class="fontinc"><strong>Name</strong></p>\
                        <p class="fontinc"><strong>Username</strong></p>';
            if(data2 != null && (data2.type =='2'|| data2.type == '3'))
            {
              x += '<p class="fontinc"><strong>Email</strong></p>';
            }
            if(data2 != null && (data2.type == '1' || data2.type == '3'))
            {
              x += '<p class="fontinc"><strong>Mobile Number</strong></p>';
            }
                        
              x += '<p class="fontinc"><strong>Role</strong></p>\
                    <p class="fontinc"><strong>Donor</strong></p>';
            if(data.donor == 'on')
            {
              x += '<p class="fontinc"><strong>Blood Group</strong></p>';
            }
            x += '</div>\
                  <div class="col-sm-1" style="text-align: center;">\
                    <p class="fontinc"><strong>:</strong></p>\
                    <p class="fontinc"><strong>:</strong></p>';
            if(data2 != null && (data2.type =='2'|| data2.type == '3'))
            {
              x += '<p class="fontinc"><strong>:</strong></p>';
            }
            if(data2 != null && (data2.type == '1' || data2.type == '3'))
            {
              x += '<p class="fontinc"><strong>:</strong></p>';
            }
                        
              x += '<p class="fontinc"><strong>:</strong></p>\
                    <p class="fontinc"><strong>:</strong></p>';
            if(data.donor == 'on')
            {
              x += '<p class="fontinc"><strong>:</strong></p>';
            }       
            x += '</div>\
                  <div class="col-sm-6">\
                    <p class="fontinc"><i>'+ data.name.toUpperCase() +'</i></p>\
                    <p class="fontinc"><i>'+ data.username +'</i></p>';
            if(data2 != null && (data2.type =='2'|| data2.type == '3'))
            {
              x += '<p class="fontinc"><i>'+ data.email +'</i></p>';
            }
            if(data2 != null && (data2.type == '1' || data2.type == '3'))
            {
              x += '<p class="fontinc"><i>'+ data.mobile +'</i></p>';
            }
            if(data.role == 'doctor')
            {
              x += '<p class="fontinc"><i>Doctor</i></p>';
            }
            else
            {
              x += '<p class="fontinc"><i>General User</i></p>';
            }
            if(data.donor == 'on')
            {
              x += '<p class="fontinc"><i>Yes</i></p>\
                    <p class="fontinc"><i>'+ data.bloodgrp +'</i></p>';
            }
            else
            {
              x += '<p class="fontinc"><i>No</i></p>';
            }
            
            x += '</div>\
                  </div><br/>';
            if(data2 != null && (data2.type == '0' && data2.status == '0'))
            {
              x += '<p class="fontinc" style="text-align:center;color:red;"><span>Requested for contact details..but not accepted your request yet</span></p>';
            }
            else if(data2 == null)
            {
              x += '<p class="fontinc" style="margin-left:50px;">For Contact Details..</p>\
                    <p style="text-align:center;"><button class="btn btn-success"\
                    onclick="reqst(\''+ data.username +'\')">REQUEST</button></p>';
            }
            x += '</div>\
                </div>';
            document.getElementById('pro_body').innerHTML = x;
          }
        };
      }
    }; 
  });
function reqst(x)
{
  var y = event.target;
  console.log('inside req');
  var xhttp= new XMLHttpRequest();
  xhttp.open('GET', '/request/'+x, true);
  xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
  xhttp.send();
  xhttp.onreadystatechange = function(){
    if (this.readyState == 4 && this.status == 200) {
      if(this.responseText == '0'){
        $('#reqfailModal').modal('show');
      }
      else if(this.responseText == '1'){
        $('#reqsuccModal').modal('show');
        y.innerHTML = 'REQUESTED';
        y.setAttribute('disabled',true);
      }
    }
}
}
</script>
</body>
</html>